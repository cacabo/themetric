<div class="space-1"></div>

<%= bootstrap_form_for @article, html: { multipart: true } do |f| %>

<%= f.file_field :image, label: 'Image: ', class: 'marg-left-1 marg-bot-1' %>

<% if @article.errors.any? %>
<div id="error_explanation">
  <h2>
    <%= pluralize(@article.errors.count, "error") %>
    prohibited this article from being saved:
  </h2>
  <ul>
    <% @article.errors.full_messages.each do |msg| %>
    <li><%= msg %></li>
    <% end %>
  </ul>
</div>
<% end %>

<%= f.text_field :title, hide_label: true, placeholder: "Title", class: 'title no-border', wrapper: { class: 'marg-bot-0' }, required: true, autofocus: true %>
<%= f.text_area :subtitle, rows: 1, hide_label: true, placeholder: "Quickly summarize your article...", class: 'serif subtitle no-border', required: true %>
<%= f.trix_editor :text, class: 'serif bigger text', required: true %>

<div class="space-1"></div>

<div class="field special-label alwaysHasVal">
  <%= f.select :region, [['None', :undefined], ['North America', :north_america], ['South America', :south_america], ['Europe', :europe], ['Middle East & North Africa', :middle_east_and_north_africa], ['Africa', :africa], ['Asia & Oceania', :asia_and_oceania]]%>
</div>

<div class="field special-label">
  <%= f.text_field :tag_list, value: @article.tag_list.join(", "), label: "Tags (separated by commas)" %>
</div>

<div class="space-1"></div>

<%= f.hidden_field :published, value: (true and @article.published), class: 'no-display' %>
<p class="text-muted">
  To display images, surround a link to the image in [square brackets]. If using a local file, upload it to some external service with a stable link.
</p>
<%= f.submit "Submit Article", class: "btn-blue shade-3 hover btn-big disabled", id: "submit" %>
<% end %>

<script type="text/javascript">
  var hasTitle = false;
  var hasSubtitle = false;
  var hasText = false;
  var $title = $('#article_title');
  var $subtitle = $('#article_subtitle');
  var $text = $('#article_text');
  var $submit = $('#submit');

  function disable() {
    if (hasTitle && hasSubtitle && hasText) {
      $submit.removeClass('disabled');
    } else {
      $submit.addClass('disabled');
    }
  }

  if ($title && $title.val().length > 0) {
    hasTitle = true;
  }

  if ($subtitle && $subtitle.val().length > 0) {
    hasSubtitle = true;
  }

  if ($text && $text.val().length > 0) {
    hasText = true;
    disable();
  }

  $title.keydown(function() {
    if ($(this).val().length > 3) {
      hasTitle = true;
      disable();
    } else {
      hasTitle = false;
      $submit.addClass('disabled');
    }
  });

  $subtitle.keydown(function() {
    if ($(this).val().length > 3) {
      hasSubtitle = true;
      disable();
    } else {
      hasSubtitle = false;
      $submit.addClass('disabled');
    }
  });

  $text.keydown(function() {
    if ($text.val().length > 3) {
      hasText = true;
      disable();
    } else {
      hasText = false;
      $submit.addClass('disabled');
    }
  });
</script>
